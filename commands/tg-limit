#!/usr/bin/env python3

import json
import os
import sys

BASE_DIR = os.path.expanduser("~/Applications/Open-source/Time guardian")
CONFIG_FILE = os.path.join(BASE_DIR, "data/config.json")

# Load existing config
if os.path.exists(CONFIG_FILE):
    with open(CONFIG_FILE, "r") as f:
        config = json.load(f)
else:
    config = {"daily_limit_minutes": 120, "daily_limit_seconds": 0}

# Ask user for new limit
try:
    new_minutes = int(input("Enter daily limit in minutes: "))
    new_seconds = int(input("Enter additional seconds (0 if none): "))
except ValueError:
    print("Invalid input. Please enter integers only.")
    sys.exit(1)

# Update config
config["daily_limit_minutes"] = max(0, new_minutes)
config["daily_limit_seconds"] = max(0, new_seconds)

# Ensure the directory exists before writing
os.makedirs(os.path.dirname(CONFIG_FILE), exist_ok=True)

with open(CONFIG_FILE, "w") as f:
    json.dump(config, f)

print(f"Daily limit set to {config['daily_limit_minutes']}m {config['daily_limit_seconds']}s")
